set default=2
set timeout=-1

if loadfont $prefix/font.pf2 ; then
	set gfxmode=640x480
	insmod vbe
	insmod gfxterm
	terminal_output gfxterm
fi

insmod png
if background_image $prefix/splash.png ; then
	set color_normal=white/black
	set color_highlight=black/white
else
	set menu_color_normal=cyan/blue
	set menu_color_highlight=white/blue
fi

menuentry "Debian GNU/Hurd installer boot menu" {
	true
}

menuentry "" {
	true
}

menuentry "Text install" {
	echo "Loading ..."
	multiboot $prefix/gnumach.gz root=gunzip:device:rd0 TERM=mach-color desktop=xfce
	module --nounzip /boot/initrd.gz initrd '$(ramdisk-create)'
	module $prefix/ext2fs.static ext2fs \
			--multiboot-command-line='${kernel-command-line}' \
			--host-priv-port='${host-port}' \
			--device-master-port='${device-port}' \
			--exec-server-task='${exec-task}' -T typed '${root}' \
			'$(task-create)' '$(task-resume)'
	module $prefix/ld.so.1 exec /hurd/exec '$(exec-task=task-create)'
}

menuentry "Pseudo-graphical install" {
	echo "Loading ..."
	multiboot $prefix/gnumach.gz root=gunzip:device:rd0 GTK_NOVESA=1 desktop=xfce
	module --nounzip /boot/initrd.gz initrd '$(ramdisk-create)'
	module $prefix/ext2fs.static ext2fs \
			--multiboot-command-line='${kernel-command-line}' \
			--host-priv-port='${host-port}' \
			--device-master-port='${device-port}' \
			--exec-server-task='${exec-task}' -T typed '${root}' \
			'$(task-create)' '$(task-resume)'
	module $prefix/ld.so.1 exec /hurd/exec '$(exec-task=task-create)'
}

menuentry "Graphical install" {
	echo "Loading ..."
	multiboot $prefix/gnumach.gz root=gunzip:device:rd0 desktop=xfce
	module --nounzip /boot/gtk/initrd.gz initrd '$(ramdisk-create)'
	module $prefix/ext2fs.static ext2fs \
			--multiboot-command-line='${kernel-command-line}' \
			--host-priv-port='${host-port}' \
			--device-master-port='${device-port}' \
			--exec-server-task='${exec-task}' -T typed '${root}' \
			'$(task-create)' '$(task-resume)'
	module $prefix/ld.so.1 exec /hurd/exec '$(exec-task=task-create)'
}

menuentry "Automated install" {
	echo "Loading ..."
	multiboot $prefix/gnumach.gz root=gunzip:device:rd0 auto=true priority=critical TERM=mach-color desktop=xfce
	module --nounzip /boot/initrd.gz initrd '$(ramdisk-create)'
	module $prefix/ext2fs.static ext2fs \
			--multiboot-command-line='${kernel-command-line}' \
			--host-priv-port='${host-port}' \
			--device-master-port='${device-port}' \
			--exec-server-task='${exec-task}' -T typed '${root}' \
			'$(task-create)' '$(task-resume)'
	module $prefix/ld.so.1 exec /hurd/exec '$(exec-task=task-create)'
}

menuentry "Expert install" {
	echo "Loading ..."
	multiboot $prefix/gnumach.gz root=gunzip:device:rd0 priority=low TERM=mach-color desktop=xfce
	module --nounzip /boot/initrd.gz initrd '$(ramdisk-create)'
	module $prefix/ext2fs.static ext2fs \
			--multiboot-command-line='${kernel-command-line}' \
			--host-priv-port='${host-port}' \
			--device-master-port='${device-port}' \
			--exec-server-task='${exec-task}' -T typed '${root}' \
			'$(task-create)' '$(task-resume)'
	module $prefix/ld.so.1 exec /hurd/exec '$(exec-task=task-create)'
}
